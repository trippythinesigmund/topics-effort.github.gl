<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Minecraft Server Dashboard</title>
  
  <link href="https://fonts.cdnfonts.com/css/minecraftia" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>Server Dashboard</h1>

  <div class="container">
    <div class="box">
      <h3>Java Server Status</h3>
      <div id="status">Checking...</div>
      <div id="players-count"></div>
      <ul id="players-list"></ul>
      <div id="updated" style="font-size: 12px; color: gray; margin-top: 10px;"></div>
    </div>

    <div class="box">
      <h3>Access Server IPs</h3>
      <div id="unlock-ui">
        <p style="font-size: 0.95rem; color: #555;">What is the last name of the person hosting this server?</p>
        <input type="text" id="answer-input" placeholder="Type answer here...">
        <button id="reveal-btn" onclick="unlock()">Reveal IPs</button>
      </div>

      <div id="ip-ui" class="ip-box">
        <div class="ip-line"><strong>JAVA:</strong> <span id="j-ip"></span> <button class="copy-btn" onclick="copy('j-ip')">Copy</button></div>
        <div class="ip-line"><strong>BEDROCK:</strong> <span id="b-ip"></span> <button class="copy-btn" onclick="copy('b-ip')">Copy</button></div>
        <div class="ip-line"><strong>PORT:</strong> <span id="b-port"></span> <button class="copy-btn" onclick="copy('b-port')">Copy</button></div>
        <button style="background:#95a5a6; margin-top:10px; width:100%; border:none; color:white; padding:10px; border-radius:8px; cursor:pointer;" onclick="logout()">Lock Again</button>
      </div>
    </div>
  </div>

<script>
const WORKER_URL = "https://wandering-band-bb01.pahpahpalll.workers.dev/"; 

window.onload = () => {
  refreshStatus();
  const saved = localStorage.getItem("mc_key");
  if (saved) attemptUnlock(saved, true);
};

function refreshStatus() {
  fetch(WORKER_URL).then(r => r.json()).then(data => updateUI(data));
}

function unlock() {
  const val = document.getElementById("answer-input").value;
  attemptUnlock(val, false);
}

function attemptUnlock(key, isAuto) {
  const btn = document.getElementById("reveal-btn");

  fetch(WORKER_URL, { headers: { "X-Access-Key": key } })
  .then(r => r.json())
  .then(data => {
    if (data.authorized) {
      localStorage.setItem("mc_key", key);
      document.getElementById("unlock-ui").style.display = "none";
      document.getElementById("ip-ui").style.display = "block";
      document.getElementById("j-ip").textContent = data.ips.java;
      document.getElementById("b-ip").textContent = data.ips.bedrock;
      document.getElementById("b-port").textContent = data.ips.port;
      updateUI(data);
    } else if (!isAuto) {
      // Trigger Red/Pressed Effect
      btn.classList.add("error-btn");
      btn.textContent = "Wrong Answer!";
      
      // Reset after 1 second
      setTimeout(() => {
        btn.classList.remove("error-btn");
        btn.textContent = "Reveal IPs";
      }, 1000);
    }
  });
}

function updateUI(data) {
  const s = document.getElementById("status");
  const countDisplay = document.getElementById("players-count");
  const listDisplay = document.getElementById("players-list");

  if (data.online) {
    document.body.style.backgroundColor = "#e8f5e9";
    s.innerHTML = "<span style='color:#27ae60'>● ONLINE</span>";
    countDisplay.textContent = `Players: ${data.players.online}/${data.players.max}`;
    listDisplay.innerHTML = data.players.list?.map(p => `<li>${p.name}</li>`).join('') || "<li>No players</li>";
  } else {
    // RESET UI ON OFFLINE
    document.body.style.backgroundColor = "#ffebee";
    s.innerHTML = "<span style='color:#e74c3c'>● OFFLINE</span>";
    countDisplay.textContent = "Players: 0/0"; // Forces it to reset
    listDisplay.innerHTML = ""; // Clears the names
  }
  document.getElementById("updated").textContent = "Last sync: " + new Date().toLocaleTimeString();
}

function copy(id) {
  navigator.clipboard.writeText(document.getElementById(id).textContent);
  alert("Copied!");
}

function logout() { localStorage.clear(); location.reload(); }
setInterval(refreshStatus, 60000);
</script>
</body>
</html>



